FROM vm/ubuntu:18.04
# To note: Layerfiles create VMs, *not* containers!

# Install node
RUN curl -fSsL https://deb.nodesource.com/setup_16.x | bash && \
    curl -fSsL https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - && \
    echo "deb https://dl.yarnpkg.com/debian/ stable main" > /etc/apt/sources.list.d/yarn.list && \
    apt-get update && \
    apt-get install nodejs yarn


# get git
# RUN curl -Lo /usr/local/bin/fast-git-download https://gist.githubusercontent.com/ColinChartier/6bff7cf77adf7d2a8d7d699a5deed707/raw/0b89b3037548ce7e4fb24bea96628014da1bbf05/download && \
#  chmod 755 /usr/local/bin/fast-git-download

# RUN REPEATABLE fast-git-download conpagoaus/image_processor.git /frontend origin/main


CLONE https://github.com/conpagoaus/image_processor.git /frontend
WORKDIR /frontend
# RUN cd /root/frontend && \
#     yarn install --frozen-lockfile && \
#     yarn compile && \
#     yarn build
# # COPY / .
RUN ls -al
RUN yarn install --frozen-lockfile
RUN yarn compile
RUN BACKGROUND yarn functions-framework --target=healthCheck --source=build/
EXPOSE WEBSITE http://localhost:8080
